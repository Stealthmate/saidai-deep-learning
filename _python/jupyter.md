---
layout: default
title: Jupyter
toc: true
published: 2019-11-09
last_edit: 2019-11-09
---

# 事前知識・準備

{% assign lnk = site.python | where: "url", "/python/anaconda_env.html" | first %}
{% assign lnk1 = site.python | where: "url", "/python/python_intro.html" | first %}
- [{{ lnk.title }}]({{ lnk.url | relative_url }})
- [{{ lnk1.title }}]({{ lnk1.url | relative_url }})
- ユーザー名が`michael`だと仮定する

# Jupyterって何？

簡単に言うと、Jupyterはブラウザーで[Literate Programming](https://ja.wikipedia.org/wiki/%E6%96%87%E8%8A%B8%E7%9A%84%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0)をするためのものです。Pythonコードの間に説明文や画像を挟んだり、変数の値などを出力したりできるエディターです。Jupyterで書いたものは生のPythonスクリプトとは違うので、`.py`ではなく、`.ipynb`（**iPy**thon **N**ote**B**ook）として保存され、中身もただのコードではなく、いろいろなものが入っています。

# Jupyterの起動と使い方

Jupyterは、起動されたディレクトリーの中身しか見れないので、Terminalで自分が書いたものを保存したいところに行って、`jupyter notebook`と書きます。そうすると、恐らく自動的にブラウザーが開かれます。

ブラウザーのURLを良く見てみると、`localhost:8888/tree`のような形になっていることに気づきます。実は、Jupyterは自分のパソコン上に建っている、ごく普通のウエブサイトです。というのは、どのブラウザーでも使うことができます。

`localhost`というのは、`google.com`と同じ**Domain Name**ですが、常に「このパソコン」を指します。つまり、私のパソコンで`localhost`と書けば、それが私のパソコンを指し、あなたのパソコンで`localhost`と書けば、あなたのパソコンを指します。

次に、`:8888`という部分は**Port**を指します。ポートとは、簡単に言うとネットワーク通信が通る出入り口のことです。パソコンは常にいろいろなサイトやサーバーと接続しているので、出入り口がいっぱいあります。その中で、デフォルトの設定としてJupyterはポート8888を使います。また、Domain Nameにポートを指定したいときに、`domain.com:<port>`と書けばできますが、ほとんどのウェブサイトは1つのポートでしか受付をしないので、`localhost`以外で使うことは普段ありません。最後に、`google.com`のポートをどうやって知っているかというと、インターネットの決まりごととして、ウェブサイトはHTTPの場合はポート80、HTTPSの場合はポート443を使うことが決まっています。

では、Jupyterを開くと、ディレクトリー内のファイルの一覧が最初に表示されます。そこで、右上にある`New`ボタンから、新しいPython3のノートブックを作りましょう。箱の中に`3 + 2`を書いて、`Run`（あるいは`Ctrl+ENTER`）を押すと、結果が表示されます。

# セルの役割

メニューから`Cell -> Insert Cell Below/Above`（`Shift+ENTER`）を押すと、新しい**Cell**が追加されます。セルというのは、簡単に言うとコードのひと塊で、Jupyterの実行単位です。つまり極端な話をすると、一行毎にセルを切ると、一行ずつコードを実行できます。

## PythonセルとMarkdownセル

JupyterではPythonセルとMarkdownセルという2種類のセルがデフォルトで使えます。PythonセルはPythonコードで先程述べたように、一つの実行単位です。一方MarkdownセルはMarkdownで書かれた文章を表示します。新しいセルを追加する時、デフォルトではPythonセルになりますが、メニューで`Cell -> Cell Type -> Markdown`を押すと、Markdownセルに変わります。Markdownセルの中にMarkdownを書いて、`Ctrl+ENTER`を押すと、フォーマットが適用された文章が表示されます。


## Markdownについて

Markdownとは、Github等で良く使う、テキストに簡単なフォーマットを与えるためのmarkup言語（upをdownにしたのが名前の由来）です。この記事も実はMarkdownで書かれています。書き方については[ここに](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet)一覧がありますが、例えばこの記事の見出しは以下のように書いています：

```
# セルの役割
## PythonセルとMarkdownセル
## Markdownについて
```

`#`は大きな見出し、`##`はそれより小さめな見出し、`###`は更に小さな見出し等、様々なフォーマットがあるので、ぜひ上のリンクを参照してください。

## 数式を表示する方法

MarkdownセルではMarkdownだけではなく、[MathJax](https://www.mathjax.org/)という、$\LaTeX$の構文で書かれた数式を表示してくれるものも使えます。数式コードを\\$\\$ ... \\$\\$で括ると、数式が表示されます。$\LaTeX$の数式構文についてはいろいろなところで書いてありますが、簡単な例として次のコードとその成果物を載せておきます。

以下を書けば：
```latex
$$
\frac{\partial}{\partial x} f(x, y) = \sum_i^N{\sqrt{x_i + \beta^2}}
$$
```

この結果になります：

$$
\frac{\partial}{\partial x} f(x, y) = \sum_i^N{\sqrt{x_i + \beta^2}}
$$


# セルの実行順番とプログラムの状態

JupyterがPythonコードを実行するときに、少し特殊な処理をします。まず最初に、Pythonのkernel（カーネル）と呼ばれるものを起動します。カーネルとは要するにPythonのインタプリタみたいなものだと思ってください。JupyterはこのカーネルにセルAの内容を渡して、実行してもらい、結果を出力します。しかし、その時、もしセルAの中で変数や関数を定義したら、それらの情報はカーネルに保存され、次にセルBが実行されたときに、セルAで定義したものが使えます。

これを以下の例を用いて説明しましょう。

まず、Notebookの頭にセルAを作り、中に以下を書いたとします。

```python
x = 3
print(x)
```

セルAを実行すると、結果が`3`が出力されます。次に下にセルBを作り、以下を書きます：

```python
y = 5
print(x, y)
```

ここでセルBを実行すると、結果が`3, 5`になります。セルAを先に実行したので、カーネルに`x`変数とその値が保存されています。次に、セルCを作ります。

```python
x = 10
print(x, y)
```
セルCを実行すると、結果が`10, 5`になります。

さて、ここで再度セルBを実行するとどうなるでしょうか。答えは`10, 5`です。なぜかと言うと、最後にセルCを実行したとき、`x`の値が変わり、それがカーネルの中に保存されたからです。

---

上の例から分かるように、Jupyterでコードを実行するとき、実行順番に気をつけなければいけません。そのために、セルの`In`と`Out`のところに番号が書かれています。その番号は、カーネルを起動してから何番目のセル実行であるか、つまりどのセルをどのタイミングで最後実行したのかを教えてくれます。

# Jupyterで頻繁に使うショートカットの一覧

以下は、セルでカーソルが表示されていない（フォーカスが無いと言います）状態でそのキーを押すと、動作します。

| キー                 | 動作                                                                                                               |
|----------------------|------------------------------------------------------------------------------------------------------------------|
|                      |                                                                                                                  |
| `a`                  | 今いるセルの上に新しくセルが作られます（**a**boveから）                                                                   |
| `b`                  | 今いるセルの下に新しくセルが作られます（**b**elowから）                                                          |
| `dd`                 | 今いるセルが消されます(**d**eleteから）                                                                          |
| `<Ctrl>+<ENTER>`      | 今いるセルが実行されます（Markdownの場合はMarkdownコードからフォーマット付きテキストに変わります）               |
| `<ENTER>`            | 今いるセルがMarkdownセルで、フォーマット付き状態であれば、Markdownコードが表示される状態に変わります。           |
| `<ESC>`              | 今いるセルでカーソルが表示されている状態から表示されていない状態に変わります（「フォーカスを失う」と言います）。 |
| `<UP>`または`<DOWN>` | フォーカス無しの状態で上下のセルへの移動                                                                         |
| `<Shift>+<ENTER>`    | `<Ctrl>+<ENTER>`の次に`<DOWN>`を押したのに等しい。                                                                              |
