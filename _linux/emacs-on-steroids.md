---
layout: default
title: "Emacs基礎知識"
series: Emacs on Steroids
series_part: 1
last_edit: 2019-11-11
toc: true
---

# 事前知識・準備

{% assign lnk = site.linux | where: "url", "/linux/profile.html" | first %}
- [{{ lnk.title }}]({{ lnk.url | relative_url }})
- ユーザー名が`michael`だと仮定する

# Emacsの入れ方

まずはインストールしましょう。

```
sudo apt install emacs25
```

## 日本語入力の設定

Emacsで日本語入力を使うには、Emacs内でのIM (Input Method)か、システムのIMがあります。Emacs内のIMでもいいのですが、私の経験上、止まったり遅かったりするので、システムIMの方が使いやすかったので、ここでシステムIMを使うための設定を記述します。

結論から言うと、Emacsを起動する際に`LC_CTYPE=ja_JP.utf-8 emacs`で起動すればいいだけです。理由は[ここ](https://www.gnu.org/software/emacs/manual/html_node/emacs/Language-Environments.html)に書いているはずですが、私にも良く理解できていません。

それで、上のコマンドを毎回打つのが面倒なので、`/home/michael/bin/bemacs`という実行ファイルを作って、`bemacs`で起動できるようにします。

```bash
emacs /home/michael/bin/bemacs
```

でまず普通のEmacsを起動して、ファイルの中に以下を書きます：

```bash
#!/bin/sh

LC_CTYPE=ja_JP.utf-8 emacs $@
```

簡単な説明をすると、`#!/bin/sh`はこのファイルは`shell`で実行しろという意味で、`$@`は渡された引数をそのまま`emacs`に渡します。ファイルを保存してから、実行権限を与えなければいけません。

```bash
cd /home/michael/bin
chmod +x bemacs
```

以上で終わりです。今度からTerminalで`bemacs`と打てば、上のファイルが実行され、`LC_CTYPE`が設定されたEmacsが起動されます。

# Emacsの中身

> Emacs is an OS, disguised as a text editor.

掲示板などで良くこういうことが言われます。直訳すると、「Emacsはテキストエディタを装ったOSだ」という意味で、ようするにやろうと思えばどんなことでもEmacsでできるという意味です。

Emacsのコアには[Lisp](https://en.wikipedia.org/wiki/Lisp_(programming_language))というプログラミング言語の方言 - [Emacs Lisp](https://en.wikipedia.org/wiki/Emacs_Lisp) (ELisp) - のインタプリタがあります。簡単に言うと、Emacsで行うほぼ全ての処理（移動、テキスト検索、ファイル管理など）はこのElispで書かれたスクリプトの実行結果です。したがって、Emacsの設定を変えるときも当然Elispを書かなければなりません。

Elisp含めLispという言語はとても面白いので、ぜひ皆さん（私含め）に勉強してほしいですが、Emacsのカスタマイズでは極端に高度なことをしようとしない限り、完全に理解しなくてもいいです。たいてい、他の人が書いたコードを参考にしながら、自分でいろいろ書くだけで済みます。

# コマンドの実行方法

Emacsで実際に意味がある作業をする時、必ずコマンドを使います。皆さんは既にいくつかのコマンドを知っているはずです。`Ctrl+X Ctrl+F`を打つと、`find-file`というコマンドが実行され、編集したいファイルを探すことができます。また、`Ctrl+X Ctrl+C`を打つと、`save-buffers-kill-terminal`コマンドが実行され、Emacsが終了します。

コマンドは2つの方法で実行できます。一つは先程言ったように、ショートカットを使って実行する方法です。もう一つは、コマンドの名前を直接指定して実行する方法です。コマンドの名前をしていする時は（皮肉なことに）`Alt+X`を打つと、Emacs画面の一番したの**prompt**で、コマンドの名前を入力できます。なお、途中まで入力し、`TAB`キーを押すと、自動補完が使えます。

試しに`Alt+X`を打って、`find-file`を実行してみましょう。

# ショートカットの記述方法

先程は`Ctrl+X Ctrl+F`のように、ショートカットを記述しましたが、実はEmacsは独自の書式を採用しています。ここではその書式について簡単に説明します。ただし、Macキーボードは仕様が違うので、下の説明は当てはまりません。

まず、**modifier keys**（修飾キー）について説明します。ほとんどのショートカットは修飾キーを用いて実行します。キーボードには4つの修飾キーがあります。

- `Ctrl` - 最下行の一番左（或いは左から2番め）と左矢印の左側にあるのボタンです。`Ctrl`と書いてあります。
- `Meta` - Metaキーは2通りあります。一つは`ESC` (`Escape`)キーです。もう一つはキーボード最下行のスペースの左右にあるボタンです。`Alt`または`Alt Gr`と書いてあります。
- `Super` - これは所謂Windowsキーです。Windowsのロゴが書いてあるキーのことです。
- `Shift` -`Shift`または太い矢印の輪郭が書いてあるキーです。

---

さて、修飾キーを定義しましたので、今度は書式自体について説明します。

まず、修飾キーを使ったショートカットは、修飾キー記号の後ろに`-`を書き、該当キーを書きます。`Ctrl`キーと`Meta`キーはそれぞれの頭文字を使って記述します。例えば

```
C-x C-f
```

これは上に書いた`Ctrl+X Ctrl+F`という、`find-file`コマンドのショートカットです。また

```
M-x
```

これは上に書いた`Alt+X`という、コマンド名を指定して実行するときに使うショートカットです。また、修飾キーを組み合わせたい時、同じく`-`でつなげ、`C-M-S-s`の順で書きます。ここで、`S`は`Shift`キー、`s`は`Super`キーを意味します。例えば、`C-M-s k`は`Ctrl+Alt+Super+k`を意味します。

---

最後に、`Shift`キーを使うショートカットについての注意点です。今後ショートカットを定義するときに上記の書式を使いますが、`Shift`を使う文字の場合は一般的に`C-S-k`のようには書かないで、`C-K`と書きます。これはなぜかと言うと、`S-k`を打つと`K`という文字になるからです。また、記号に関しても同じで、`C-S-1`ではなく、`C-!`と書きます。

***だがしかし***

ここでキーボードの[US配列とJIS配列](http://www.nagasaki-gaigo.ac.jp/toguchi/pc/multilingual/keyboard_us_jis.htm)が関係して来ます。Emacsはアメリカ人がアメリカ人向けに作ったものなので、当然US配列を使っています。そこで、`C-@`というショートカットを考えてみましょう。JIS配列（日本で普及している配列）では特に面白いものではないですね。しかし、US配列で見るとこれは`C-S-2`に等しいです。

この違いによって、US配列では論理性があるショートカットでも、JIS配列では意味不明なことになっていることがありえるので、注意する必要があります。

個人的な意見ですが、JISキーボードはキーが無駄に多く、スペースが無駄に狭かったり、記号の配置が理不尽なところがあるので、US配列をおすすめします。US配列は、設定すればJISキーボードでも使えますが、当然キーボードに書いている文字が違ってくるので、慣れるまでは大変かもしれません。

## 特別なキーの書き方

| キー名      | 書き方      |
|-------------|-------------|
| Enter       | `RET`       |
| Escape      | `ESC`       |
| Tab         | `TAB`       |
| Left Arrow  | `left`      |
| Right Arrow | `right`     |
| Up Arrow    | `up`        |
| Down Arrow  | `down`      |
| Backspace   | `backspace` |

# コマンドについて調べたい時

## あるコマンドの意味やショートカットを調べたい時

あるコマンドが何をするか、どのショートカットで実行できるかを調べたいとき、`C-h f`を打ち、promptでコマンド名を入力して`RET`を打つと、helpが表示されます。helpにはコマンドによっていろいろ書かれていますが、`It is bound to`と書いてある文に注目すると、どのショートカットで実行できるかが書いています。例えば、`C-h f find-file RET`を打つと、`find-file`の説明が表示されます。

## あるショートカットに紐付いているコマンドを調べたい時

このショートカットを打つとどうなるんだろう、ということを調べたければ、`C-h k`を打ち、その次にショートカットを打つと、もしそれにコマンドが紐付いていればhelpが表示されます。例えば、`C-h k C-x C-f`を打つと、`find-file`の説明が表示されます。

# まとめ

今回はEmacsの基本的なところを把握し、基礎を勉強しました。次回はEmacsの設定の変え方や簡単なカスタマイズについて書きたいと思います。
